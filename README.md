# Django Telegram Bot Project

Этот проект представляет собой веб-приложение на Django, интегрированное с Telegram-ботом. Приложение разворачивается с использованием Docker, а непрерывная интеграция и доставка (CI/CD) настроены через GitHub Actions.

## Развернутое приложение

Проект автоматически развертывается и доступен по адресу: **http://158.160.203.139**

## 1. Локальная настройка и запуск

### Требования
- Docker
- Docker Compose

### Шаги запуска
1.  **Клонируйте репозиторий:**
    ```bash
    git clone <your-repository-url>
    cd <repository-folder>
    ```

2.  **Создайте файл переменных окружения:**
    Создайте файл с именем `.env` в корневой директории проекта. Он необходим для хранения секретов и настроек.

3.  **Заполните `.env` файл:**
    Скопируйте в него следующие переменные и задайте им значения. Эти данные будут использоваться для локальной базы данных PostgreSQL.
    ```env
    # Настройки для Django
    SECRET_KEY=your_local_secret_key_here
    DEBUG=True

    # Настройки базы данных (для Docker Compose)
    POSTGRES_DB=your_db_name
    POSTGRES_USER=your_db_user
    POSTGRES_PASSWORD=your_db_password

    # Настройки для Telegram бота
    TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here
    ```

4.  **Запустите проект с помощью Docker Compose:**
    Эта команда соберет образы Docker для веб-приложения и базы данных, создаст и запустит контейнеры.
    ```bash
    docker-compose up --build
    ```
    После выполнения команды ваше приложение будет доступно по адресу `http://localhost:8000`.

## 2. CI/CD и Деплой на сервер

Процесс CI/CD автоматизирован с помощью GitHub Actions и настроен в файле `.github/workflows/ci-cd.yml`. Деплой происходит автоматически при каждом пуше в ветку `feature`.

### Как это работает?
1.  **Push в `feature`:** Разработчик отправляет изменения в ветку `feature`.
2.  **Запуск GitHub Action:** GitHub автоматически запускает рабочий процесс, который тестирует и проверяет код.
3.  **SSH-подключение:** В случае успеха GitHub Action использует сохраненные секреты для безопасного подключения к вашему удаленному серверу по SSH.
4.  **Развертывание на сервере:** На сервере выполняются следующие шаги:
    - Переход в директорию проекта.
    - Создание или обновление файла `.env` с продакшен-переменными.
    - Загрузка последних изменений из репозитория (`git pull origin feature`).
    - Пересборка и перезапуск Docker-контейнеров в фоновом режиме (`docker-compose up -d --build`).

### Настройка CI/CD

Для того чтобы автоматический деплой заработал, вам необходимо один раз настроить "Secrets" в вашем репозитории на GitHub.

1.  Перейдите в ваш репозиторий на GitHub.
2.  Откройте `Settings` > `Secrets and variables` > `Actions`.
3.  Нажмите `New repository secret` для каждого из следующих ключей:

| Секрет                | Описание                                                                  | Пример значения                      |
| --------------------- | ------------------------------------------------------------------------- | ------------------------------------ |
| `SSH_HOST`            | Публичный IP-адрес вашего сервера.                                        | `158.160.203.139`                    |
| `SSH_USER`            | Имя пользователя для подключения к серверу.                               | `ubuntu`                             |
| `SSH_PRIVATE_KEY`     | **Приватный** SSH-ключ, который вы сгенерировали (содержимое файла `id_rsa`). | `-----BEGIN OPENSSH PRIVATE KEY...`   |
| `POSTGRES_DB`         | Имя для **продакшен** базы данных.                                        | `prod_db`                            |
| `POSTGRES_USER`       | Пользователь для **продакшен** базы данных.                               | `prod_user`                          |
| `POSTGRES_PASSWORD`   | Пароль для **продакшен** базы данных.                                     | `ultra_secret_password`              |
| `SECRET_KEY`          | Секретный ключ Django для **продакшен** среды.                            | `django-insecure-xyz...`             |
| `TELEGRAM_BOT_TOKEN`  | Токен Telegram-бота.                                               | `123456:ABC-DEF1234...`              |

После того как все секреты будут добавлены, любой `git push` в ветку `feature` будет автоматически разворачивать последнюю версию приложения на сервере.
